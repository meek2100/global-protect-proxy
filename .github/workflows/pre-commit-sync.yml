# File: .github/workflows/pre-commit-sync.yaml
name: Dependabot Pre-Commit Sync

on:
  pull_request:
    types: [opened, synchronize]
    branches: ["dependabot/**"]
    paths:
      - "Dockerfile"
      - "entrypoint.sh"
      - "server.py"
      - ".pre-commit-config.yaml"
      - ".github/workflows/*"
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Dependabot's Branch
        uses: actions/checkout@v5
        with:
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.14"

      - name: Set up Node.js
        uses: actions/setup-node@v6
        with:
          node-version: 20

      - name: Install pre-commit
        run: pip install pre-commit

      - name: Run pre-commit autoupdate
        run: pre-commit autoupdate

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v8
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore(deps): update pre-commit hooks"
          branch: "pre-commit-sync/${{ github.event.pull_request.head.ref }}"
          title: "chore(deps): synchronize pre-commit hooks for ${{ github.event.pull_request.head.ref }}"
          body: |
            This PR synchronizes the `.pre-commit-config.yaml` hooks following a Dependabot update.

            Triggered by PR: #${{ github.event.pull_request.number }}
          labels: |
            dependencies
            automerge
